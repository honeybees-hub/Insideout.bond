<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#2563eb">
    <title>PDF Splitter - Insideout.bond</title>
    <link rel="shortcut icon" href="images/logo.png" type="image/x-icon">
    <meta name="application-name" content="Insideout.bond">

    <!-- Meta Tags for SEO -->
    <meta name="description"
        content="Split PDF files instantly in your browser for free. Extract specific pages or ranges securely without uploading to a server. No quality loss, no watermarks.">
    <meta name="keywords"
        content="pdf splitter, split pdf online, extract pdf pages, free pdf tool, separate pdf pages, pdf cutter, secure pdf processing, Insideout.bond">
    <link rel="canonical" href="https://insideout.bond/Tools/PDF-SPLITTER.HTML">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://insideout.bond/Tools/PDF-SPLITTER.HTML">
    <meta property="og:title" content="PDF Splitter - Insideout.bond">
    <meta property="og:description"
        content="Split PDF files instantly in your browser for free. Secure client-side processing.">
    <meta property="og:image" content="https://insideout.bond/Tools/images/logo.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://insideout.bond/Tools/PDF-SPLITTER.HTML">
    <meta property="twitter:title" content="PDF Splitter - Insideout.bond">
    <meta property="twitter:description"
        content="Split PDF files instantly in your browser for free. Secure client-side processing.">
    <meta property="twitter:image" content="https://insideout.bond/Tools/images/logo.png">

    <!-- AdSense -->
    <!-- <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2280832801216201"
        crossorigin="anonymous"></script> -->

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1605V9LS1K"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-1605V9LS1K');
    </script>

    <!-- Structured Data (JSON-LD) for Software Application -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "PDF Splitter - Insideout.bond",
      "operatingSystem": "Web",
      "applicationCategory": "ProductivityApplication",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "description": "A free online tool to split PDF files and extract pages directly in the browser without server uploads."
    }
    </script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- PDF-Lib -->
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .drop-zone {
            transition: all 0.3s ease;
            background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='12' ry='12' stroke='%23CBD5E1FF' stroke-width='2' stroke-dasharray='12%2c 12' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
        }

        .drop-zone.active {
            background-color: #eff6ff;
            background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='12' ry='12' stroke='%233B82F6FF' stroke-width='2' stroke-dasharray='12%2c 12' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
            transform: scale(1.01);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #3b82f6;
            width: 20px;
            height: 20px;
            -webkit-animation: spin 1s linear infinite;
            /* Safari */
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body class="min-h-screen flex flex-col text-slate-800">

    <!-- Header -->
    <header class="bg-white border-b border-slate-200 sticky top-0 z-10">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <div class="p-2 bg-blue-600 rounded-lg text-white">
                    <i data-lucide="scissors" class="w-5 h-5"></i>
                </div>
                <h1
                    class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-600 to-indigo-600">
                    PDF Splitter - Insideout.bond
                </h1>
            </div>
            <div class="text-sm text-slate-500 hidden sm:block">
                Secure Client-Side Processing
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow p-4 sm:p-8">
        <div class="max-w-3xl mx-auto space-y-12">

            <!-- Tool Section -->
            <section aria-label="PDF Splitting Tool">
                <!-- Intro Text -->
                <div class="text-center space-y-2 mb-8">
                    <h2 class="text-3xl font-bold text-slate-900">Split PDF files instantly</h2>
                    <p class="text-slate-600">Extract pages from your documents. No file limits, no uploads to servers.
                    </p>
                </div>

                <!-- Upload Section -->
                <div id="upload-section" class="bg-white rounded-2xl p-8 shadow-sm border border-slate-100">
                    <div id="drop-zone"
                        class="drop-zone h-64 rounded-xl flex flex-col items-center justify-center cursor-pointer relative group">
                        <input type="file" id="file-input" accept="application/pdf"
                            class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-20"
                            aria-label="Upload PDF file">

                        <div
                            class="z-10 flex flex-col items-center space-y-4 text-center p-6 transition-transform group-hover:-translate-y-1">
                            <div
                                class="w-16 h-16 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center mb-2 group-hover:bg-blue-100 transition-colors">
                                <i data-lucide="upload-cloud" class="w-8 h-8"></i>
                            </div>
                            <div>
                                <p class="text-lg font-semibold text-slate-700">Click to upload or drag and drop</p>
                                <p class="text-sm text-slate-500 mt-1">PDF files only</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Workspace Section (Hidden initially) -->
                <div id="workspace-section" class="hidden space-y-6">

                    <!-- File Info Card -->
                    <div
                        class="bg-white rounded-xl p-4 shadow-sm border border-slate-200 flex items-center justify-between">
                        <div class="flex items-center gap-4 overflow-hidden">
                            <div
                                class="w-12 h-12 bg-red-50 text-red-500 rounded-lg flex items-center justify-center flex-shrink-0">
                                <i data-lucide="file-text" class="w-6 h-6"></i>
                            </div>
                            <div class="min-w-0">
                                <h3 id="filename-display" class="font-medium text-slate-900 truncate">document.pdf</h3>
                                <p id="page-count-display" class="text-sm text-slate-500">Loading...</p>
                            </div>
                        </div>
                        <button id="remove-file-btn"
                            class="p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors"
                            aria-label="Remove file">
                            <i data-lucide="trash-2" class="w-5 h-5"></i>
                        </button>
                    </div>

                    <!-- Controls -->
                    <div class="bg-white rounded-2xl shadow-lg border border-slate-100 overflow-hidden">
                        <div class="p-6 border-b border-slate-100 bg-slate-50/50">
                            <h3 class="font-semibold text-slate-900 flex items-center gap-2">
                                <i data-lucide="layers" class="w-4 h-4 text-blue-500"></i>
                                Select Pages to Extract
                            </h3>
                        </div>

                        <div class="p-6 space-y-6">
                            <!-- Mode Selector -->
                            <div class="flex gap-4">
                                <label class="flex-1 cursor-pointer">
                                    <input type="radio" name="split-mode" value="range" checked class="peer sr-only">
                                    <div
                                        class="h-full p-4 rounded-xl border-2 border-slate-200 peer-checked:border-blue-500 peer-checked:bg-blue-50 hover:bg-slate-50 transition-all text-center">
                                        <div class="font-medium text-slate-900 peer-checked:text-blue-700">Custom Range
                                        </div>
                                        <div class="text-xs text-slate-500 mt-1">e.g., 1-5, 8, 11-13</div>
                                    </div>
                                </label>
                                <label class="flex-1 cursor-pointer">
                                    <input type="radio" name="split-mode" value="single" class="peer sr-only">
                                    <div
                                        class="h-full p-4 rounded-xl border-2 border-slate-200 peer-checked:border-blue-500 peer-checked:bg-blue-50 hover:bg-slate-50 transition-all text-center">
                                        <div class="font-medium text-slate-900 peer-checked:text-blue-700">Single Page
                                        </div>
                                        <div class="text-xs text-slate-500 mt-1">Extract just one page</div>
                                    </div>
                                </label>
                            </div>

                            <!-- Input Area -->
                            <div class="space-y-2">
                                <label for="page-range" class="block text-sm font-medium text-slate-700">Page
                                    Numbers</label>
                                <div class="relative">
                                    <input type="text" id="page-range" placeholder="Example: 1-5, 8, 11-13"
                                        class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-slate-900 placeholder-slate-400">
                                    <div class="absolute right-3 top-3 text-slate-400">
                                        <i data-lucide="hash" class="w-5 h-5"></i>
                                    </div>
                                </div>
                                <p id="helper-text" class="text-xs text-slate-500 flex items-center gap-1">
                                    <i data-lucide="info" class="w-3 h-3"></i>
                                    Enter page numbers separated by commas or ranges with hyphens.
                                </p>
                                <p id="error-message" class="hidden text-sm text-red-600 flex items-center gap-1 mt-2">
                                    <i data-lucide="alert-circle" class="w-4 h-4"></i>
                                    <span class="content">Invalid range</span>
                                </p>
                            </div>

                            <!-- Action Button -->
                            <button id="split-btn"
                                class="w-full py-4 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-semibold shadow-md hover:shadow-lg transform active:scale-[0.99] transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                                <span>Split & Download PDF</span>
                                <i data-lucide="download" class="w-5 h-5"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Features & Benefits (SEO Content) -->
            <section class="grid md:grid-cols-3 gap-6 pt-8">
                <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                    <div class="w-10 h-10 bg-green-100 text-green-600 rounded-lg flex items-center justify-center mb-4">
                        <i data-lucide="shield-check" class="w-5 h-5"></i>
                    </div>
                    <h3 class="font-bold text-slate-900 mb-2">100% Secure & Private</h3>
                    <p class="text-sm text-slate-600">All splitting happens in your browser. Your PDF files never leave
                        your device and are never uploaded to any server.</p>
                </div>
                <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                    <div
                        class="w-10 h-10 bg-purple-100 text-purple-600 rounded-lg flex items-center justify-center mb-4">
                        <i data-lucide="zap" class="w-5 h-5"></i>
                    </div>
                    <h3 class="font-bold text-slate-900 mb-2">Lightning Fast</h3>
                    <p class="text-sm text-slate-600">No upload or download times. Even large documents are processed
                        instantly using advanced web assembly technology.</p>
                </div>
                <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                    <div
                        class="w-10 h-10 bg-orange-100 text-orange-600 rounded-lg flex items-center justify-center mb-4">
                        <i data-lucide="check-square" class="w-5 h-5"></i>
                    </div>
                    <h3 class="font-bold text-slate-900 mb-2">Quality Preserved</h3>
                    <p class="text-sm text-slate-600">Your extracted pages retain their original formatting, metadata,
                        and quality. No watermarks are added.</p>
                </div>
            </section>

            <!-- How To Use (SEO Content) -->
            <section class="bg-white rounded-2xl p-8 border border-slate-200 shadow-sm">
                <h2 class="text-2xl font-bold text-slate-900 mb-6">How to Split PDF Files Online</h2>
                <div class="space-y-4">
                    <div class="flex gap-4">
                        <div
                            class="flex-shrink-0 w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center font-bold text-sm">
                            1</div>
                        <div>
                            <h4 class="font-semibold text-slate-900">Upload your PDF</h4>
                            <p class="text-slate-600 text-sm mt-1">Drag and drop your PDF document into the box above or
                                click to select a file from your computer.</p>
                        </div>
                    </div>
                    <div class="flex gap-4">
                        <div
                            class="flex-shrink-0 w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center font-bold text-sm">
                            2</div>
                        <div>
                            <h4 class="font-semibold text-slate-900">Select Pages</h4>
                            <p class="text-slate-600 text-sm mt-1">Choose "Custom Range" to extract specific sequences
                                (e.g., 1-5, 10) or "Single Page" for one specific page.</p>
                        </div>
                    </div>
                    <div class="flex gap-4">
                        <div
                            class="flex-shrink-0 w-8 h-8 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center font-bold text-sm">
                            3</div>
                        <div>
                            <h4 class="font-semibold text-slate-900">Download New PDF</h4>
                            <p class="text-slate-600 text-sm mt-1">Click the "Split & Download PDF" button. Your new
                                file will be created and downloaded instantly to your device.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- FAQ Section (Schema Ready) -->
            <section class="space-y-6">
                <h2 class="text-2xl font-bold text-slate-900">Frequently Asked Questions</h2>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <h3 class="font-semibold text-slate-900">Is this PDF splitter free?</h3>
                        <p class="text-sm text-slate-600">Yes, this tool is 100% free to use with no hidden costs or
                            subscriptions required.</p>
                    </div>
                    <div class="space-y-2">
                        <h3 class="font-semibold text-slate-900">Is it safe to use?</h3>
                        <p class="text-sm text-slate-600">Absolutely. Unlike other tools, we do not upload your files to
                            a server. All processing happens locally on your computer, ensuring complete privacy.</p>
                    </div>
                    <div class="space-y-2">
                        <h3 class="font-semibold text-slate-900">Can I split password-protected PDFs?</h3>
                        <p class="text-sm text-slate-600">Currently, you need to unlock the PDF before uploading it. We
                            prioritize security and do not attempt to bypass file encryption.</p>
                    </div>
                    <div class="space-y-2">
                        <h3 class="font-semibold text-slate-900">Does it work on Mac and Windows?</h3>
                        <p class="text-sm text-slate-600">Yes! Because this tool runs in your web browser (Chrome,
                            Firefox, Safari, Edge), it works on Windows, Mac, Linux, and even mobile devices.</p>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-slate-200 py-8 mt-auto">
        <div class="max-w-5xl mx-auto px-4 text-center">
            <div class="flex justify-center items-center gap-2 mb-4">
                <div class="p-1.5 bg-blue-600 rounded text-white">
                    <i data-lucide="scissors" class="w-4 h-4"></i>
                </div>
                <span class="font-bold text-slate-900">PDF Splitter - Insideout.bond</span>
            </div>
            <p class="text-sm text-slate-500 mb-4">Files are processed locally in your browser for maximum privacy. No
                data is stored or shared.</p>
            <div class="text-xs text-slate-400">
                &copy; 2026 Insideout.bond. All rights reserved.
            </div>
        </div>
    </footer>

    <!-- Toast Notification -->
    <div id="toast"
        class="fixed bottom-4 right-4 bg-slate-800 text-white px-6 py-3 rounded-lg shadow-xl transform translate-y-24 transition-transform duration-300 flex items-center gap-3 z-50">
        <i data-lucide="check-circle" class="w-5 h-5 text-green-400"></i>
        <span id="toast-message">Success!</span>
    </div>

    <script>
        // --- State Management ---
        const state = {
            file: null,
            pdfDoc: null,
            pageCount: 0,
            fileName: '',
        };

        // --- DOM Elements ---
        const elements = {
            dropZone: document.getElementById('drop-zone'),
            fileInput: document.getElementById('file-input'),
            uploadSection: document.getElementById('upload-section'),
            workspaceSection: document.getElementById('workspace-section'),
            filenameDisplay: document.getElementById('filename-display'),
            pageCountDisplay: document.getElementById('page-count-display'),
            removeFileBtn: document.getElementById('remove-file-btn'),
            pageRangeInput: document.getElementById('page-range'),
            splitBtn: document.getElementById('split-btn'),
            errorMessage: document.getElementById('error-message'),
            errorContent: document.querySelector('#error-message .content'),
            toast: document.getElementById('toast'),
            toastMessage: document.getElementById('toast-message'),
            radioButtons: document.querySelectorAll('input[name="split-mode"]')
        };

        // --- Initialization ---
        lucide.createIcons();

        // --- Event Listeners ---

        // Drag & Drop
        elements.dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            elements.dropZone.classList.add('active');
        });

        elements.dropZone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            elements.dropZone.classList.remove('active');
        });

        elements.dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            elements.dropZone.classList.remove('active');
            if (e.dataTransfer.files.length) {
                handleFile(e.dataTransfer.files[0]);
            }
        });

        elements.fileInput.addEventListener('change', (e) => {
            if (e.target.files.length) {
                handleFile(e.target.files[0]);
            }
        });

        elements.removeFileBtn.addEventListener('click', resetApp);

        elements.splitBtn.addEventListener('click', processSplit);

        elements.pageRangeInput.addEventListener('input', () => {
            hideError();
            validateInput(elements.pageRangeInput.value);
        });

        elements.radioButtons.forEach(radio => {
            radio.addEventListener('change', (e) => {
                elements.pageRangeInput.value = '';
                hideError();
                if (e.target.value === 'single') {
                    elements.pageRangeInput.placeholder = "Example: 5";
                } else {
                    elements.pageRangeInput.placeholder = "Example: 1-5, 8, 11-13";
                }
            });
        });

        // --- Core Functions ---

        async function handleFile(file) {
            if (file.type !== 'application/pdf') {
                showToast('Please upload a valid PDF file.', 'error');
                return;
            }

            // Clear previous inputs if re-uploading via Drag/Drop
            // This prevents stale invalid ranges (e.g. range 10-20 on a 5 page doc)
            elements.pageRangeInput.value = '';
            hideError();

            // UI Loading State
            elements.dropZone.innerHTML = `
                <div class="loader mb-4"></div>
                <p class="text-slate-600 font-medium">Loading PDF...</p>
            `;

            try {
                const arrayBuffer = await file.arrayBuffer();
                state.file = arrayBuffer;
                state.fileName = file.name;

                // Load PDF with pdf-lib
                state.pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
                state.pageCount = state.pdfDoc.getPageCount();

                // Update UI
                elements.filenameDisplay.textContent = state.fileName;
                elements.pageCountDisplay.textContent = `${state.pageCount} Pages`;

                elements.uploadSection.classList.add('hidden');
                elements.workspaceSection.classList.remove('hidden');

                // Auto-focus input
                elements.pageRangeInput.focus();

            } catch (error) {
                console.error(error);
                resetApp();
                if (error.message.includes('Encrypted')) {
                    showToast('This PDF is password protected. Please unlock it first.', 'error');
                } else {
                    showToast('Error reading PDF. The file might be corrupt.', 'error');
                }
            }
        }

        function resetApp() {
            // Reset State
            state.file = null;
            state.pdfDoc = null;
            state.pageCount = 0;
            state.fileName = '';

            // Reset UI
            elements.fileInput.value = '';
            elements.pageRangeInput.value = '';
            hideError();

            elements.workspaceSection.classList.add('hidden');
            elements.uploadSection.classList.remove('hidden');

            // Restore Drop Zone HTML
            elements.dropZone.innerHTML = `
                <input type="file" id="file-input" accept="application/pdf" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-20" aria-label="Upload PDF file">
                <div class="z-10 flex flex-col items-center space-y-4 text-center p-6 transition-transform group-hover:-translate-y-1">
                    <div class="w-16 h-16 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center mb-2 group-hover:bg-blue-100 transition-colors">
                        <i data-lucide="upload-cloud" class="w-8 h-8"></i>
                    </div>
                    <div>
                        <p class="text-lg font-semibold text-slate-700">Click to upload or drag and drop</p>
                        <p class="text-sm text-slate-500 mt-1">PDF files only</p>
                    </div>
                </div>
            `;
            // Re-attach listener to new input element
            document.getElementById('file-input').addEventListener('change', (e) => {
                if (e.target.files.length) handleFile(e.target.files[0]);
            });
            lucide.createIcons();
        }

        // Helper for strict integer checking
        function isStrictInteger(str) {
            return /^\d+$/.test(str);
        }

        function parseRangeString(rangeStr, maxPages) {
            // Using Array to preserve user order (e.g., "5, 1" should output page 5 then 1)
            const pages = [];
            const parts = rangeStr.split(',').map(p => p.trim()).filter(p => p);

            for (const part of parts) {
                if (part.includes('-')) {
                    const rangeParts = part.split('-').map(p => p.trim());
                    if (rangeParts.length !== 2) throw new Error("Invalid range format (use start-end)");

                    if (!rangeParts[0] || !rangeParts[1]) throw new Error("Incomplete range");
                    if (!isStrictInteger(rangeParts[0]) || !isStrictInteger(rangeParts[1])) {
                        throw new Error("Ranges must contain only numbers");
                    }

                    const start = parseInt(rangeParts[0]);
                    const end = parseInt(rangeParts[1]);

                    // Allow reverse ranges (5-1) or forward (1-5)
                    const low = Math.min(start, end);
                    const high = Math.max(start, end);

                    if (low < 1 || high > maxPages) throw new Error(`Page numbers must be between 1 and ${maxPages}`);

                    // Generate range inclusive
                    if (start <= end) {
                        for (let i = start; i <= end; i++) pages.push(i - 1);
                    } else {
                        // If user strictly typed 5-1, we give them 5,4,3,2,1
                        for (let i = start; i >= end; i--) pages.push(i - 1);
                    }
                } else {
                    if (!isStrictInteger(part)) throw new Error(`Invalid page number: "${part}"`);

                    const num = parseInt(part);
                    if (num < 1 || num > maxPages) throw new Error(`Page number ${num} is out of bounds (1-${maxPages})`);
                    pages.push(num - 1); // 0-indexed
                }
            }

            return pages;
        }

        function validateInput(val) {
            if (!val) return false;
            try {
                parseRangeString(val, state.pageCount);
                return true;
            } catch (e) {
                return false;
            }
        }

        async function processSplit() {
            const inputVal = elements.pageRangeInput.value;

            if (!inputVal) {
                showError("Please enter page numbers to extract.");
                return;
            }

            // Set Loading Button State
            const originalBtnText = elements.splitBtn.innerHTML;
            elements.splitBtn.disabled = true;
            elements.splitBtn.innerHTML = `<div class="loader"></div> <span class="ml-2">Preserving Quality...</span>`;

            try {
                // 1. Parse Pages
                const pageIndices = parseRangeString(inputVal, state.pageCount);

                if (pageIndices.length === 0) {
                    throw new Error("No valid pages selected.");
                }

                // 2. Create New Document
                const newPdf = await PDFLib.PDFDocument.create();

                // 3. COPY METADATA (Quality Preservation)
                // Using explicit checks to avoid undefined splitting errors
                const title = state.pdfDoc.getTitle();
                const author = state.pdfDoc.getAuthor();
                const subject = state.pdfDoc.getSubject();
                const keywords = state.pdfDoc.getKeywords();
                const creator = state.pdfDoc.getCreator();
                const producer = state.pdfDoc.getProducer();
                const creationDate = state.pdfDoc.getCreationDate();
                const modificationDate = state.pdfDoc.getModificationDate();

                if (title) newPdf.setTitle(title);
                if (author) newPdf.setAuthor(author);
                if (subject) newPdf.setSubject(subject);

                // Bug Fix: Check if keywords exists before processing
                if (keywords) {
                    // We simply pass the string array. If it's a single string with commas,
                    // we can try to respect that or just pass it as one entry.
                    // pdf-lib setKeywords expects string[]. 
                    // To be safe and preserve original string intact:
                    newPdf.setKeywords([keywords]);
                }

                if (creator) newPdf.setCreator(creator);
                if (producer) newPdf.setProducer(producer);
                if (creationDate) newPdf.setCreationDate(creationDate);
                if (modificationDate) newPdf.setModificationDate(modificationDate);

                // 4. Copy Pages (Lossless copy of content streams)
                // Note: copyPages returns pages in the order of indices provided.
                const copiedPages = await newPdf.copyPages(state.pdfDoc, pageIndices);

                // 5. Add Pages to New Doc
                copiedPages.forEach(page => newPdf.addPage(page));

                // 6. Save and Download
                const pdfBytes = await newPdf.save();

                downloadBlob(pdfBytes, `split_${state.fileName}`);

                showToast(`Successfully processed ${pageIndices.length} pages!`);

            } catch (error) {
                console.error("Split Error:", error);
                showError(error.message);
            } finally {
                // Reset Button
                elements.splitBtn.disabled = false;
                elements.splitBtn.innerHTML = originalBtnText;
                lucide.createIcons();
            }
        }

        function downloadBlob(data, fileName) {
            const blob = new Blob([data], { type: 'application/pdf' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a); // Required for Firefox
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }

        // --- UI Utilities ---

        function showError(msg) {
            elements.errorContent.textContent = msg;
            elements.errorMessage.classList.remove('hidden');
            elements.pageRangeInput.classList.add('border-red-300', 'focus:ring-red-200', 'focus:border-red-500');
            elements.pageRangeInput.classList.remove('focus:ring-blue-500', 'focus:border-blue-500');
        }

        function hideError() {
            elements.errorMessage.classList.add('hidden');
            elements.pageRangeInput.classList.remove('border-red-300', 'focus:ring-red-200', 'focus:border-red-500');
            elements.pageRangeInput.classList.add('focus:ring-blue-500', 'focus:border-blue-500');
        }

        function showToast(msg, type = 'success') {
            elements.toastMessage.textContent = msg;
            const icon = elements.toast.querySelector('i');

            if (type === 'error') {
                icon.setAttribute('data-lucide', 'alert-triangle');
                icon.classList.remove('text-green-400');
                icon.classList.add('text-red-400');
            } else {
                icon.setAttribute('data-lucide', 'check-circle');
                icon.classList.remove('text-red-400');
                icon.classList.add('text-green-400');
            }
            lucide.createIcons();

            elements.toast.classList.remove('translate-y-24');

            setTimeout(() => {
                elements.toast.classList.add('translate-y-24');
            }, 3000);
        }

    </script>
</body>

</html>