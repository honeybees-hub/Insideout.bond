<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chrome Dino Game</title>
    <link rel="shortcut icon" href="images/logo.png" type="image/x-icon">

    <meta name="application-name" content="Inbondz">
    
    <meta name="google-adsense-account" content="ca-pub-2280832801216201">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        :root {
            --bg-color: #f7f7f7;
            --canvas-bg: #ffffff;
            --text-color: #535353;
            --accent-color: #535353;
        }

        body.dark-mode {
            --bg-color: #171717;
            --canvas-bg: #202124;
            --text-color: #acacac;
            --accent-color: #acacac;
        }

        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: var(--bg-color);
            font-family: 'Press Start 2P', monospace;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            touch-action: none;
            /* Prevents mobile scrolling/zooming */
            transition: background-color 0.3s ease;
        }

        #game-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        canvas {
            display: block;
            width: 100%;
            background-color: var(--canvas-bg);
            border-radius: 8px;
            transition: background-color 0.3s ease;
        }

        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        /* Top Controls */
        #top-controls {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .control-btn {
            background: none;
            border: 2px solid var(--text-color);
            color: var(--text-color);
            font-family: inherit;
            font-size: 20px;
            width: 40px;
            height: 40px;
            border-radius: 5px;
            cursor: pointer;
            pointer-events: auto;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            transform: scale(1.1);
        }

        .control-btn.active {
            background-color: var(--text-color);
            color: var(--bg-color);
        }

        .hidden {
            display: none !important;
        }

        #start-screen,
        #game-over-screen {
            background: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 10px;
            border: 2px solid #535353;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        body.dark-mode #start-screen,
        body.dark-mode #game-over-screen {
            background: rgba(32, 33, 36, 0.9);
            border-color: #acacac;
        }

        h1 {
            font-size: 24px;
            color: var(--text-color);
            margin-bottom: 20px;
            text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.1);
        }

        p {
            font-size: 12px;
            color: var(--text-color);
            line-height: 1.8;
            opacity: 0.8;
        }

        .blink {
            animation: blinker 1s linear infinite;
        }

        @keyframes blinker {
            50% {
                opacity: 0;
            }
        }

        .mobile-hint {
            display: none;
        }

        @media (max-width: 600px) {
            .mobile-hint {
                display: block;
                margin-top: 10px;
            }

            .desktop-hint {
                display: none;
            }

            h1 {
                font-size: 18px;
            }
        }
    </style>
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-1605V9LS1K"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-1605V9LS1K');
</script>
<body>
    <!-- <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2280832801216201"
        crossorigin="anonymous"></script> -->
    <!-- bar add -->
    <!-- <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-2280832801216201" data-ad-slot="2506006736"
        data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script> -->

    <!-- ads end -->
    <div id="game-container">
        <div id="top-controls">
            <button id="theme-btn" class="control-btn" title="Toggle Theme">‚òÄ</button>
            <button id="speed-btn" class="control-btn" title="Toggle Speed (Rabbit=Fast, Turtle=Slow)">üêá</button>
        </div>
        <canvas id="gameCanvas"></canvas>

        <div id="ui-layer">
            <div id="start-screen">
                <h1>DINO RUNNER</h1>
                <p class="desktop-hint">Space / Up : Jump</p>
                <p class="desktop-hint">Down : Duck</p>
                <p class="mobile-hint">Tap : Jump</p>

                <p class="blink" style="margin-top: 20px; color: var(--text-color)">PRESS SPACE TO START</p>
            </div>

            <div id="game-over-screen" class="hidden">
                <h1>GAME OVER</h1>
                <p id="final-score">Score: 0</p>
                <p class="blink" style="margin-top: 15px; color: var(--text-color)">PRESS ANY KEY TO RESTART</p>
            </div>
        </div>
    </div>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2280832801216201"
        crossorigin="anonymous"></script>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startScreen = document.getElementById('start-screen');
        const gameOverScreen = document.getElementById('game-over-screen');
        const finalScoreEl = document.getElementById('final-score');
        const themeBtn = document.getElementById('theme-btn');
        const speedBtn = document.getElementById('speed-btn');

        // --- Sprites (Pixel Art Definition) ---
        // 1 = fill, 0 = empty
        const sprites = {
            dino: [
                "000000000011111100",
                "000000000111111110",
                "000000000111111110",
                "000000000111111110",
                "000000000111111000",
                "000000000111111000",
                "000000000111111000",
                "000000000111110000",
                "000000011111110000",
                "000000011111110000",
                "000000111111110000",
                "000000111111110000",
                "100000111111110000",
                "100001111111110000",
                "110011111111110000",
                "111111111111110000",
                "011111111111110000",
                "011111111111110000",
                "001111111111110000",
                "000111110011110000",
                "000111110011110000",
                "000110110011000000",
                "000110010011000000"
            ],
            dinoDuck: [
                "00000000000000000000",
                "00000000000000000000",
                "00000000000000000000",
                "00000000000000000000",
                "00000000000000000000",
                "00000000000000000000",
                "00000000000011111100",
                "00000000000111111110",
                "00000000000111111110",
                "00000000000111111000",
                "00000000000111111000",
                "00000011111111111000",
                "00000111111111111000",
                "00001111111111111000",
                "10011111111111111000",
                "11111111111111000000",
                "01111111111111000000",
                "00111111111111000000",
                "00011111001111000000",
                "00011011001100000000",
                "00011001001100000000"
            ],
            cactusSmall: [
                "0011000",
                "0111000",
                "0111001",
                "0111011",
                "0111011",
                "0111011",
                "0111011",
                "0111111",
                "0111111",
                "1111110",
                "1111100",
                "1111100",
                "0111000",
                "0111000"
            ],
            cactusLarge: [
                "00011000",
                "00011000",
                "01011010",
                "01011010",
                "01011010",
                "01011010",
                "01011010",
                "11011011",
                "11111111",
                "11111111",
                "01111110",
                "00011000",
                "00011000",
                "00011000"
            ],
            bird: [
                "000000000100000000",
                "000000001100001000",
                "000000011000011000",
                "000000111000011000",
                "000001111000011000",
                "000011111100011000",
                "000111111100011000",
                "001111111110011000",
                "111111111111000000",
                "000000111111110000",
                "000000001111111000",
                "000000000001110000",
                "000000000000100000"
            ],
            birdDown: [
                "000000000100000000",
                "000000001100001000",
                "000000011000011000",
                "000000111000011000",
                "000001111000011000",
                "000011111100011000",
                "000111111100011000",
                "001111111110011000",
                "111111111111000000",
                "001111111110000000",
                "000111111000000000",
                "000001110000000000",
                "000000100000000000"
            ]
        };

        function drawSprite(ctx, sprite, x, y, scale, color, flipX = false) {
            ctx.fillStyle = color;
            const h = sprite.length;
            const w = sprite[0].length;

            for (let r = 0; r < h; r++) {
                for (let c = 0; c < w; c++) {
                    if (sprite[r][c] === '1') {
                        let drawX = flipX ? x + (w - 1 - c) * scale : x + c * scale;
                        ctx.fillRect(drawX, y + r * scale, scale, scale);
                    }
                }
            }
        }

        // Game Constants
        let GAME_WIDTH = 800;
        let GAME_HEIGHT = 300;
        const GROUND_Y = 250;
        const DINO_X = 50;

        // FPS Control
        const FPS = 60;
        const FRAME_INTERVAL = 1000 / FPS;
        let lastTime = 0;

        let audioCtx;

        // Game State
        let isDarkMode = false;
        let isSlowMode = false;
        let gameRunning = false;
        let gameSpeed = 6;
        let initialSpeed = 6;
        let score = 0;
        let highScore = localStorage.getItem('dinoHighScore') || 0;
        let frame = 0;
        let obstacles = [];
        let clouds = [];
        let lastGameEnd = 0;

        // Colors
        let COLOR_FG = '#535353';

        // Theme Logic
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            themeBtn.innerText = isDarkMode ? 'üåô' : '‚òÄ';
            COLOR_FG = isDarkMode ? '#acacac' : '#535353';

            // Redraw immediately if stopped
            if (!gameRunning) {
                ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
                drawGround();
                dino.draw();
                obstacles.forEach(o => o.draw());
                clouds.forEach(c => c.draw());
                drawScore();
            }
        }

        themeBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            toggleTheme();
            themeBtn.blur();
        });

        speedBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            isSlowMode = !isSlowMode;
            speedBtn.innerText = isSlowMode ? 'üê¢' : 'üêá';
            speedBtn.classList.toggle('active', isSlowMode);
            speedBtn.blur();
        });

        // Dino Object
        const dino = {
            x: DINO_X,
            y: GROUND_Y,
            scale: 2,
            dy: 0,
            jumpForce: 12,
            gravity: 0.6,
            grounded: true,
            ducking: false,
            dead: false,
            runAnimTimer: 0,

            draw() {
                let sprite = sprites.dino;
                let yOffset = -44;

                if (this.ducking) {
                    sprite = sprites.dinoDuck;
                    yOffset = -40;
                }

                let bob = 0;
                if (this.grounded && !this.dead && gameRunning) {
                    if (Math.floor(this.runAnimTimer / 5) % 2 === 0) bob = 2;
                }

                drawSprite(ctx, sprite, this.x, this.y + yOffset + bob, this.scale, COLOR_FG);

                // Draw eye (white pixel)
                if (!this.dead) {
                    ctx.fillStyle = isDarkMode ? '#202124' : '#fff';
                    ctx.fillRect(this.x + (this.ducking ? 36 : 30), this.y + yOffset + bob + 4, 4, 4);
                }
            },

            update() {
                if (this.grounded && this.dy < 0) this.grounded = false;
                this.y += this.dy;

                if (this.y + this.dy < GROUND_Y) {
                    this.dy += this.gravity;
                    this.grounded = false;
                } else {
                    this.dy = 0;
                    this.grounded = true;
                    this.y = GROUND_Y;
                }
                this.runAnimTimer++;
            },

            jump() {
                if (this.grounded) {
                    this.dy = -this.jumpForce;
                    playSound('jump');
                }
            },

            duck(isDucking) {
                this.ducking = isDucking;
                this.gravity = isDucking ? 1.2 : 0.6;
            }
        };

        class Obstacle {
            constructor(type) {
                this.type = type;
                this.x = GAME_WIDTH + 50;
                this.markedForDeletion = false;

                if (type === 'cactus') {
                    this.scale = 2;
                    this.sprite = Math.random() > 0.5 ? sprites.cactusLarge : sprites.cactusSmall;
                    this.y = GROUND_Y - (this.sprite.length * this.scale);
                    this.w = this.sprite[0].length * this.scale;
                    this.h = this.sprite.length * this.scale;
                    this.clusterSize = Math.floor(Math.random() * 3) + 1;
                } else if (type === 'bird') {
                    this.scale = 2;
                    this.sprite = sprites.bird;
                    this.w = this.sprite[0].length * this.scale;
                    this.h = this.sprite.length * this.scale;
                    // Adjusted heights to ensure ducking works
                    // High: Safe to run under
                    // Mid: Jump over
                    // Low: Must duck (Moved up slightly to ensure collision with standing dino but clear ducking)
                    let heights = [GROUND_Y - 50, GROUND_Y - 75, GROUND_Y - 110];
                    this.y = heights[Math.floor(Math.random() * heights.length)];
                    this.frame = 0;
                }
            }

            update() {
                this.x -= gameSpeed;
                if (this.x < -100) this.markedForDeletion = true;

                if (this.type === 'bird') {
                    this.frame++;
                    if (Math.floor(this.frame / 10) % 2 === 0) {
                        this.sprite = sprites.bird;
                    } else {
                        this.sprite = sprites.birdDown;
                    }
                }
            }

            draw() {
                if (this.type === 'cactus') {
                    for (let i = 0; i < this.clusterSize; i++) {
                        drawSprite(ctx, this.sprite, this.x + (i * (this.w - 5)), this.y, this.scale, COLOR_FG);
                    }
                } else {
                    drawSprite(ctx, this.sprite, this.x, this.y, this.scale, COLOR_FG, true);
                }
            }

            getHitboxes() {
                let hitboxes = [];
                if (this.type === 'cactus') {
                    let totalW = (this.clusterSize * (this.w - 5)) + 5;
                    hitboxes.push({
                        x: this.x + 5, y: this.y + 5, w: totalW - 10, h: this.h - 10
                    });
                } else {
                    // Bird hitbox
                    hitboxes.push({
                        x: this.x + 5, y: this.y + 10, w: this.w - 10, h: this.h - 15
                    });
                }
                return hitboxes;
            }
        }

        class Cloud {
            constructor() {
                this.x = GAME_WIDTH + Math.random() * 400;
                this.y = 30 + Math.random() * 80;
                this.w = 40 + Math.random() * 20;
                this.speed = gameSpeed * 0.2;
            }
            draw() {
                ctx.fillStyle = isDarkMode ? '#535353' : '#dcdcdc';
                ctx.beginPath();
                ctx.arc(this.x, this.y, 15, 0, Math.PI * 2);
                ctx.arc(this.x + 15, this.y - 10, 20, 0, Math.PI * 2);
                ctx.arc(this.x + 30, this.y, 15, 0, Math.PI * 2);
                ctx.fill();
            }
            update() {
                this.x -= this.speed;
            }
        }

        function resize() {
            const container = document.getElementById('game-container');
            const aspect = GAME_WIDTH / GAME_HEIGHT;
            let w = container.offsetWidth;
            let h = w / aspect;
            canvas.style.width = w + 'px';
            canvas.style.height = h + 'px';
            canvas.width = GAME_WIDTH;
            canvas.height = GAME_HEIGHT;

            if (!gameRunning) {
                drawGround();
                dino.draw();
                drawScore();
            }
        }
        window.addEventListener('resize', resize);
        resize();

        function initAudio() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }

        function playSound(type) {
            if (!audioCtx) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            const now = audioCtx.currentTime;

            if (type === 'jump') {
                osc.type = 'square';
                osc.frequency.setValueAtTime(150, now);
                osc.frequency.exponentialRampToValueAtTime(600, now + 0.1);
                gain.gain.setValueAtTime(0.05, now);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.1);
            } else if (type === 'hit') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(200, now);
                osc.frequency.exponentialRampToValueAtTime(50, now + 0.2);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.2);
                osc.start(now);
                osc.stop(now + 0.2);
            } else if (type === 'score') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(800, now);
                gain.gain.setValueAtTime(0.05, now);
                gain.gain.linearRampToValueAtTime(0.001, now + 0.2);
                osc.start(now);
                osc.stop(now + 0.2);
            }
        }

        function drawGround() {
            ctx.beginPath();
            ctx.moveTo(0, GROUND_Y);
            ctx.lineTo(GAME_WIDTH, GROUND_Y);
            ctx.strokeStyle = COLOR_FG;
            ctx.lineWidth = 2;
            ctx.stroke();

            ctx.fillStyle = COLOR_FG;
            for (let i = 0; i < GAME_WIDTH; i += 100) {
                if (Math.random() > 0.5) ctx.fillRect(i, GROUND_Y + 5, 4, 2);
                if (Math.random() > 0.7) ctx.fillRect(i + 40, GROUND_Y + 10, 2, 2);
            }
        }

        // New FPS Clamped Game Loop
        function gameLoop(timestamp) {
            if (!gameRunning) return;

            requestAnimationFrame(gameLoop);

            // Calculate delta time to clamp FPS
            const deltaTime = timestamp - lastTime;
            if (deltaTime < FRAME_INTERVAL) return;

            lastTime = timestamp - (deltaTime % FRAME_INTERVAL);

            update();
            draw();
        }

        function update() {
            frame++;

            // Spawn clouds
            if (Math.random() < 0.005) clouds.push(new Cloud());
            clouds = clouds.filter(c => c.x > -100);
            clouds.forEach(c => c.update());

            // Spawn obstacles
            if (obstacles.length === 0 || GAME_WIDTH - obstacles[obstacles.length - 1].x > 300 + Math.random() * 200) {
                if (Math.random() < 0.02) {
                    let type = 'cactus';
                    if (score > 300 && Math.random() > 0.7) type = 'bird';
                    obstacles.push(new Obstacle(type));
                }
            }

            obstacles = obstacles.filter(o => !o.markedForDeletion);

            obstacles.forEach(obs => {
                obs.update();

                // Optimized Hitbox Collision
                let boxes = obs.getHitboxes();

                // Dino Hitbox
                // When ducking, we drastically lower height and move Y down
                let dinoHitbox = {
                    x: dino.x + 10,
                    y: dino.ducking ? dino.y - 20 : dino.y - 40,
                    w: dino.ducking ? 40 : 25,
                    h: dino.ducking ? 20 : 40
                };

                for (let box of boxes) {
                    if (
                        dinoHitbox.x < box.x + box.w &&
                        dinoHitbox.x + dinoHitbox.w > box.x &&
                        dinoHitbox.y < box.y + box.h &&
                        dinoHitbox.y + dinoHitbox.h > box.y
                    ) {
                        gameOver();
                    }
                }
            });

            dino.update();

            score += 0.1;
            gameSpeed = initialSpeed + (score / 1000);

            if (Math.floor(score) > 0 && Math.floor(score) % 100 === 0 && Math.floor(score - 0.1) % 100 !== 0) {
                playSound('score');
            }
        }

        function draw() {
            ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
            drawGround();
            clouds.forEach(c => c.draw());
            obstacles.forEach(o => o.draw());
            dino.draw();
            drawScore();
        }

        function drawScore() {
            ctx.fillStyle = COLOR_FG;
            ctx.font = '20px "Press Start 2P"';
            ctx.textAlign = 'right';
            let scoreStr = Math.floor(score).toString().padStart(5, '0');
            let highStr = Math.floor(highScore).toString().padStart(5, '0');
            ctx.fillText(`HI ${highStr}  ${scoreStr}`, GAME_WIDTH - 20, 30);
        }

        function startGame() {
            if (gameRunning) return;
            initAudio();
            // Force audio resume
            if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();

            gameRunning = true;
            score = 0;
            initialSpeed = isSlowMode ? 4 : 6;
            gameSpeed = initialSpeed;
            obstacles = [];
            clouds = [];
            dino.y = GROUND_Y;
            dino.dy = 0;
            dino.dead = false;
            dino.ducking = false;

            startScreen.classList.add('hidden');
            gameOverScreen.classList.add('hidden');

            lastTime = performance.now();
            requestAnimationFrame(gameLoop);
        }

        function gameOver() {
            gameRunning = false;
            lastGameEnd = Date.now();
            playSound('hit');
            dino.dead = true;

            if (score > highScore) {
                highScore = score;
                localStorage.setItem('dinoHighScore', highScore);
            }

            finalScoreEl.innerText = `Score: ${Math.floor(score)}`;
            gameOverScreen.classList.remove('hidden');
        }

        function handleInput(e) {
            if (!gameRunning && dino.dead) {
                if (Date.now() - lastGameEnd > 500) startGame();
                return;
            }

            if ((e.code === 'Space' || e.code === 'ArrowUp')) {
                e.preventDefault();
                if (!gameRunning) startGame();
                else dino.jump();
            }
            if (e.code === 'ArrowDown') {
                e.preventDefault();
                if (gameRunning) dino.duck(true);
            }
        }

        function handleInputUp(e) {
            if (e.code === 'ArrowDown') {
                if (gameRunning) dino.duck(false);
            }
        }

        window.addEventListener('touchstart', (e) => {
            if (e.target.closest('.control-btn')) return;
            e.preventDefault();

            if (!gameRunning && dino.dead) {
                if (Date.now() - lastGameEnd > 500) startGame();
            } else if (!gameRunning) {
                startGame();
            } else {
                dino.jump();
            }
        }, { passive: false });

        window.addEventListener('mousedown', (e) => {
            if (e.target.closest('.control-btn')) return;
            if (!gameRunning && dino.dead) {
                if (Date.now() - lastGameEnd > 500) startGame();
            } else if (!gameRunning) {
                startGame();
            } else {
                dino.jump();
            }
        });

        window.addEventListener('keydown', handleInput);
        window.addEventListener('keyup', handleInputUp);

        dino.draw();
        drawGround();
    </script>
</body>

</html>